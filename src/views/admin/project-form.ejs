<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= project ? '프로젝트 수정' : '프로젝트 추가' %> - Portfolio Admin</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            margin-top: 1rem;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            display: none;
        }
        .current-image {
            max-width: 100%;
            max-height: 200px;
            margin-top: 0.5rem;
            border-radius: 12px;
            border: 2px solid var(--border-light);
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">Admin Panel</h1>
            <ul class="nav-links">
                <li><a href="/admin">대시보드</a></li>
                <li><a href="/">사이트 보기</a></li>
            </ul>
        </div>
    </nav>

    <section class="section">
        <div class="container">
            <h2 class="section-title"><%= project ? '프로젝트 수정' : '새 프로젝트 추가' %></h2>

            <form action="<%= project ? `/admin/projects/${project.id}` : '/admin/projects' %>" method="POST" enctype="multipart/form-data" class="contact-form">
                <div class="form-group">
                    <label for="title">프로젝트 제목 *</label>
                    <input type="text" id="title" name="title" value="<%= project ? project.title : '' %>" required>
                </div>

                <div class="form-group">
                    <label for="description">설명 *</label>
                    <textarea id="description" name="description" rows="5" required><%= project ? project.description : '' %></textarea>
                </div>

                <div class="form-group">
                    <label for="technology">사용 기술 *</label>
                    <input type="text" id="technology" name="technology" value="<%= project ? project.technology : '' %>" placeholder="예: Node.js, Express, MySQL" required>
                </div>

                <div class="form-group">
                    <label for="github_url">GitHub URL</label>
                    <input type="url" id="github_url" name="github_url" value="<%= project && project.github_url ? project.github_url : '' %>" placeholder="https://github.com/username/repo">
                </div>

                <div class="form-group">
                    <label for="demo_url">데모 URL</label>
                    <input type="url" id="demo_url" name="demo_url" value="<%= project && project.demo_url ? project.demo_url : '' %>" placeholder="https://example.com">
                </div>

                <div class="form-group">
                    <label for="image">프로젝트 이미지 <%= project ? '' : '*' %></label>
                    <input
                        type="file"
                        id="image"
                        name="image"
                        accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                        <%= project ? '' : 'required' %>
                        onchange="previewImage(event)"
                    >
                    <small style="color: var(--text-muted); margin-top: 0.5rem; display: block;">
                        허용 형식: JPG, JPEG, PNG, GIF, WEBP (최대 5MB)
                        <% if (project) { %>
                            <br>새 이미지를 선택하지 않으면 기존 이미지가 유지됩니다.
                        <% } %>
                    </small>

                    <% if (project && project.image_url) { %>
                        <div style="margin-top: 1rem;">
                            <strong style="color: var(--text-primary); display: block; margin-bottom: 0.5rem;">현재 이미지:</strong>
                            <img src="<%= project.image_url %>" alt="현재 프로젝트 이미지" class="current-image">
                        </div>
                    <% } %>

                    <img id="preview" class="image-preview" alt="미리보기">
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn"><%= project ? '수정하기' : '추가하기' %></button>
                    <a href="/admin" class="btn btn-secondary">취소</a>
                </div>
            </form>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Portfolio Admin. All rights reserved.</p>
        </div>
    </footer>

    <script>
        function previewImage(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('preview');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
        }
    </script>
</body>
</html>
